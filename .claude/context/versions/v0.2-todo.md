---
created: 2025-11-29
updated: 2025-11-29
version: 0.2.0
status: in-progress
parent: '[[v0.2-prompt_plan]]'
---

# Rackarr v0.2 — Implementation Checklist

**Spec:** [[v0.2-spec]]
**Prompt Plan:** [[v0.2-prompt_plan]]

---

## Phase 1: Technical Foundation

### P01: Coordinate System Refactor (getScreenCTM)

- [x] Write tests for `screenToSVG()` function
- [x] Write tests for `svgToScreen()` function
- [x] Write equivalence tests comparing to legacy calculation
- [x] Create `src/lib/utils/coordinates.ts`
- [x] Implement `screenToSVG()` using `getScreenCTM().inverse()`
- [x] Implement `svgToScreen()` using `getScreenCTM()`
- [x] Update `Rack.svelte` handleDragOver to use `screenToSVG()`
- [x] Update `Rack.svelte` handleDrop to use `screenToSVG()`
- [x] Remove manual `getBoundingClientRect()` + `zoomScale` division
- [x] Verify all unit tests pass (663/663)
- [x] Verify all E2E tests pass (31/31)
- [x] Commit: `feat(canvas): add transform-aware coordinate utilities`

### P02: panzoom Integration

- [ ] Install panzoom package (`npm install panzoom@^9.4.3`)
- [ ] Write tests for panzoom initialization
- [ ] Write tests for zoom button controls
- [ ] Write tests for panzoom disposal on unmount
- [ ] Write tests for zoom bounds (0.25 - 2.0)
- [ ] Update `Canvas.svelte` structure: wrap racks in `<svg><g panzoom-target>`
- [ ] Initialize panzoom on mount with configuration
- [ ] Update zoom in/out button handlers to use panzoom API
- [ ] Add panzoom instance to canvas store for external control
- [ ] Remove old CSS transform zoom implementation
- [ ] Verify drag-drop still works with new structure
- [ ] Verify all unit tests pass
- [ ] Verify all E2E tests pass
- [ ] Commit: `feat(canvas): integrate panzoom for zoom and pan`

### P03: Fit All Zoom

- [ ] Write tests for `calculateRacksBoundingBox()`
- [ ] Write tests for `calculateFitAll()`
- [ ] Write test for empty racks case
- [ ] Write test for zoom cap at 200%
- [ ] Write test for content centering
- [ ] Create `src/lib/utils/canvas.ts` with bounding box functions
- [ ] Add Fit All button to Toolbar
- [ ] Add Fit All icon (expand/fit icon)
- [ ] Implement `fitAll()` function using panzoom API
- [ ] Add reduced motion support (instant vs animated)
- [ ] Add keyboard shortcut `F` for Fit All
- [ ] Update keyboard handler with F key binding
- [ ] Add tooltip "Fit All (F)" to button
- [ ] Verify all tests pass
- [ ] Commit: `feat(canvas): add Fit All zoom button`

---

## Phase 2: Core Features

### P04: Rear View Data Model

- [ ] Write type tests for `Rack.view` property
- [ ] Write type tests for `PlacedDevice.face` property
- [ ] Add `RackView` type: `'front' | 'rear'`
- [ ] Add `DeviceFace` type: `'front' | 'rear' | 'both'`
- [ ] Extend `Rack` interface with `view: RackView`
- [ ] Extend `PlacedDevice` interface with `face: DeviceFace`
- [ ] Add `DEFAULT_RACK_VIEW` constant (`'front'`)
- [ ] Add `DEFAULT_DEVICE_FACE` constant (`'front'`)
- [ ] Update layout store to handle defaults
- [ ] Verify all tests pass
- [ ] Commit: `feat(data): add rear view data model`

### P05: Rear View Toggle UI

- [ ] Write tests for RackViewToggle component
- [ ] Write test for front/rear button rendering
- [ ] Write test for current view highlighting
- [ ] Write test for view change event emission
- [ ] Create `RackViewToggle.svelte` component
- [ ] Style segmented control (front/rear buttons)
- [ ] Add aria-pressed attribute for current view
- [ ] Add aria-label for accessibility
- [ ] Integrate toggle into rack header area
- [ ] Add view state change handler in Rack.svelte
- [ ] Filter devices based on `rack.view` and `device.face`
- [ ] Implement `visibleDevices` derived state
- [ ] Verify U numbers remain in same positions (not mirrored)
- [ ] Verify all tests pass
- [ ] Commit: `feat(ui): add front/rear rack view toggle`

### P06: Device Face Assignment

- [ ] Write tests for face selector in EditPanel
- [ ] Write test for face selector visibility when device selected
- [ ] Write test for face update on selection
- [ ] Add "Mounted Face" fieldset to EditPanel
- [ ] Add radio buttons: Front / Rear / Both (full-depth)
- [ ] Wire up face change handler
- [ ] Add full-depth indicator (↔) to Device.svelte
- [ ] Style depth indicator
- [ ] Add tooltip for full-depth indicator
- [ ] Verify all tests pass
- [ ] Commit: `feat(devices): add face assignment for front/rear mounting`

### P07: Rack Duplication

- [ ] Write tests for `duplicateRack()` utility
- [ ] Write test for new UUID generation
- [ ] Write test for device UUID regeneration
- [ ] Write test for "(Copy)" name suffix
- [ ] Write test for positioning to right of original
- [ ] Write test for 6-rack limit enforcement
- [ ] Create `duplicateRack()` function in `src/lib/utils/rack.ts`
- [ ] Add "Duplicate Rack" to context menu
- [ ] Add `duplicateRack()` to layout store
- [ ] Add keyboard shortcut `Ctrl/Cmd + D`
- [ ] Show error toast when 6 racks exist
- [ ] Verify library references preserved (not duplicated)
- [ ] Verify all tests pass
- [ ] Commit: `feat(racks): add rack duplication`

---

## Phase 3: UI Polish

### P08: Device Library Toggle Button

- [ ] Write tests for toggle button rendering
- [ ] Write test for icon + text composition
- [ ] Write test for drawer toggle on click
- [ ] Write test for active state styling
- [ ] Write test for aria attributes
- [ ] Update Toolbar leftmost element
- [ ] Add Rackarr icon to toggle button
- [ ] Add "Device Library" text label
- [ ] Style with 8px gap between icon and text
- [ ] Add hover state (`--colour-surface-hover`)
- [ ] Add active state (20% opacity selection color)
- [ ] Add `aria-expanded` attribute
- [ ] Add `aria-controls="device-library-drawer"`
- [ ] Verify D key still toggles drawer
- [ ] Verify all tests pass
- [ ] Commit: `feat(toolbar): add Device Library toggle button`

### P09: Device Library Drawer Changes

- [ ] Write test verifying X close button removed
- [ ] Write test for Escape key closing
- [ ] Write test for D key closing
- [ ] Remove X close button from drawer header
- [ ] Verify toggle button closes drawer
- [ ] Verify Escape closes drawer
- [ ] Verify D key closes drawer
- [ ] Update drawer ID to `device-library-drawer`
- [ ] Rename "Device Palette" to "Device Library" in UI
- [ ] Verify all tests pass
- [ ] Commit: `refactor(drawer): remove X close button, use toggle/Escape/D`

### P10: Rack Title Above Rack

- [ ] Write test for title position above rack body
- [ ] Write test for export title positioning
- [ ] Update Rack.svelte title `y` position to `-8`
- [ ] Update `text-anchor` to `middle`
- [ ] Update `dominant-baseline` to `auto`
- [ ] Center title on rack width
- [ ] Update export SVG rendering for title position
- [ ] Update export PNG rendering for title position
- [ ] Verify canvas rendering correct
- [ ] Verify export rendering correct
- [ ] Verify all tests pass
- [ ] Commit: `fix(ui): position rack title above rack`

### P11: Device Icon Vertical Alignment

- [ ] Write test for icon vertical centering
- [ ] Update Device.svelte `.device-content` CSS
- [ ] Add `display: flex`
- [ ] Add `align-items: center`
- [ ] Add `justify-content: flex-start`
- [ ] Add `height: 100%`
- [ ] Update export SVG icon positioning
- [ ] Use `dominant-baseline="middle"` for SVG icons
- [ ] Calculate `iconY = deviceY + deviceHeight / 2`
- [ ] Verify canvas icons centered
- [ ] Verify export icons centered
- [ ] Verify all tests pass
- [ ] Commit: `fix(ui): vertically centre device icons`

### P12: Help Panel Update

- [ ] Write test for GitHub link presence
- [ ] Write test for Forgejo link absence
- [ ] Remove Forgejo repository link from HelpPanel
- [ ] Keep GitHub repository link
- [ ] Keep app name and version
- [ ] Keep brief description
- [ ] Keep keyboard shortcuts reference
- [ ] Keep license (MIT)
- [ ] Keep credits/attribution
- [ ] Verify all tests pass
- [ ] Commit: `docs(help): remove internal Forgejo link`

---

## Phase 4: Data & Migration

### P13: Device Library Import

- [ ] Write tests for `parseDeviceLibraryImport()`
- [ ] Write tests for `validateDevice()`
- [ ] Write test for valid JSON parsing
- [ ] Write test for invalid entry skipping
- [ ] Write test for duplicate name handling
- [ ] Write test for height validation (0.5 - 100)
- [ ] Write test for category validation
- [ ] Create `src/lib/utils/import.ts`
- [ ] Implement `validateDevice()` function
- [ ] Implement `parseDeviceLibraryImport()` function
- [ ] Add "Import" button to Device Library drawer
- [ ] Add file input for JSON upload
- [ ] Wire up import handler
- [ ] Merge imported devices with existing library
- [ ] Show toast: "Imported X devices (Y skipped)"
- [ ] Verify all tests pass
- [ ] Commit: `feat(library): add device library import from JSON`

### P14: v0.1 to v0.2 Migration

- [ ] Write tests for `migrateLayout()`
- [ ] Write test for v0.1 rack view defaulting
- [ ] Write test for v0.1 device face defaulting
- [ ] Write test for v0.2 layout preservation
- [ ] Write test for version field update
- [ ] Create/update `src/lib/utils/layout.ts`
- [ ] Implement `migrateLayout()` function
- [ ] Detect layout version from `version` field
- [ ] Apply defaults for missing `view` property
- [ ] Apply defaults for missing `face` property
- [ ] Update version to `0.2.0`
- [ ] Integrate migration into layout loading
- [ ] Verify v0.1 layouts load correctly
- [ ] Verify v0.2 layouts unchanged
- [ ] Verify all tests pass
- [ ] Commit: `feat(migration): add v0.1 to v0.2 layout migration`

---

## Final Validation

### All Tests Pass

- [ ] Unit tests: `npm run test:run` (target: 700+)
- [ ] E2E tests: `npm run test:e2e` (target: 35+)
- [ ] Type check: `npm run check`
- [ ] Lint: `npm run lint`
- [ ] Build: `npm run build`

### Success Criteria (from spec)

#### Core Features

- [ ] User can toggle between front/rear rack view
- [ ] Devices can be assigned to front, rear, or both faces
- [ ] "Fit All" zooms canvas to show all racks
- [ ] Racks can be duplicated with all devices
- [ ] Device library can be imported from JSON

#### UI Polish

- [ ] Device Library button (with Rackarr icon) toggles drawer
- [ ] Device Library drawer has no X close button
- [ ] Rack titles appear above racks (canvas and export)
- [ ] Device icons are vertically centred
- [ ] Help panel shows only GitHub link (no Forgejo)

#### Technical Foundation

- [ ] panzoom library integrated for canvas zoom/pan
- [ ] Coordinate handling uses getScreenCTM() for transform-aware positioning
- [ ] Drag-and-drop works correctly at all zoom levels and pan positions

#### Compatibility

- [ ] All existing v0.1 functionality preserved
- [ ] v0.1 layouts load correctly with appropriate defaults

### Manual Testing Checklist

- [ ] Create new rack, verify title above rack
- [ ] Add device, verify icon vertically centered
- [ ] Toggle front/rear view, verify device visibility
- [ ] Assign device to rear face, verify in rear view
- [ ] Assign device to both faces, verify in both views
- [ ] Duplicate rack, verify all devices copied
- [ ] Use Fit All at various zoom levels
- [ ] Pan canvas, verify drag-drop works
- [ ] Import device library JSON
- [ ] Load v0.1 layout file, verify migration
- [ ] Export PNG/SVG, verify title above rack
- [ ] Open help panel, verify no Forgejo link
- [ ] Test keyboard shortcuts (F, D, Ctrl+D)

---

## Release Checklist

- [ ] All prompts implemented and committed
- [ ] All tests passing
- [ ] Manual testing complete
- [ ] Update version in `package.json` to `0.2.0`
- [ ] Update CHANGELOG.md
- [ ] Create release commit: `chore: v0.2.0 release`
- [ ] Tag release: `git tag v0.2.0`
- [ ] Push to origin with tags

---

## Progress Summary

| Phase                   | Prompts                 | Status |
| ----------------------- | ----------------------- | ------ |
| 1. Technical Foundation | P01, P02, P03           | 1/3 ✅ |
| 2. Core Features        | P04, P05, P06, P07      | 0/4 ⬜ |
| 3. UI Polish            | P08, P09, P10, P11, P12 | 0/5 ⬜ |
| 4. Data & Migration     | P13, P14                | 0/2 ⬜ |

**Total:** 1/14 prompts complete

---

_Update this checklist as you complete each item._
